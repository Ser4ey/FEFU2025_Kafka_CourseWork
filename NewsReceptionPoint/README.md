# NewsReceptionPoint - ะขะตะปะตะณัะฐะผ-ะฑะพั ะดะปั ะฟัะธะตะผะฐ ะฝะพะฒะพััะตะน

## ะะฟะธัะฐะฝะธะต ะฟัะพะตะบัะฐ

NewsReceptionPoint - ััะพ ะฐัะธะฝััะพะฝะฝัะน Telegram-ะฑะพั, ะฟัะตะดะฝะฐะทะฝะฐัะตะฝะฝัะน ะดะปั ัะฑะพัะฐ ะฝะพะฒะพััะตะน ะพั ะบะพััะตัะฟะพะฝะดะตะฝัะพะฒ ะธ ะธั ะพัะฟัะฐะฒะบะธ ะฒ ัะธััะตะผั ัะตัะตะฝะทะธัะพะฒะฐะฝะธั ัะตัะตะท Apache Kafka. ะะพั ะพะฑะตัะฟะตัะธะฒะฐะตั ัะตะณะธัััะฐัะธั ะฟะพะปัะทะพะฒะฐัะตะปะตะน, ะฟัะธะตะผ ะฝะพะฒะพััะตะน ะธ ัะฒะตะดะพะผะปะตะฝะธะต ะฐะฒัะพัะพะฒ ะพ ัะตะทัะปััะฐัะฐั ะผะพะดะตัะฐัะธะธ.

### ะัะฝะพะฒะฝัะต ะฒะพะทะผะพะถะฝะพััะธ

- ๐ค **ะะตะณะธัััะฐัะธั ะฟะพะปัะทะพะฒะฐัะตะปะตะน** - ะฟัะพััะฐั ัะตะณะธัััะฐัะธั ัะตัะตะท ะธะผั ะฟะพะปัะทะพะฒะฐัะตะปั
- ๐ฐ **ะัะธะตะผ ะฝะพะฒะพััะตะน** - ะฟะพัะฐะณะพะฒัะน ะฒะฒะพะด ะทะฐะณะพะปะพะฒะบะฐ ะธ ัะพะดะตัะถะฐะฝะธั ะฝะพะฒะพััะธ
- ๐ค **ะัะฟัะฐะฒะบะฐ ะฒ Kafka** - ะฐะฒัะพะผะฐัะธัะตัะบะฐั ะพัะฟัะฐะฒะบะฐ ะฝะพะฒะพััะตะน ะฒ ัะพะฟะธะบ `news-to-review`
- ๐จ **ะฃะฒะตะดะพะผะปะตะฝะธั** - ะฟะพะปััะตะฝะธะต ัะตะทัะปััะฐัะพะฒ ัะตัะตะฝะทะธัะพะฒะฐะฝะธั ะธะท ัะพะฟะธะบะฐ `news-reviewed`
- ๐พ **ะะฐะทะฐ ะดะฐะฝะฝัั** - ััะฐะฝะตะฝะธะต ะธะฝัะพัะผะฐัะธะธ ะพ ะทะฐัะตะณะธัััะธัะพะฒะฐะฝะฝัั ะบะพััะตัะฟะพะฝะดะตะฝัะฐั
- ๐ **ะัะธะฝััะพะฝะฝะพััั** - ะฟะพะปะฝะพัััั ะฐัะธะฝััะพะฝะฝะฐั ะฐััะธัะตะบัััะฐ ะดะปั ะฒััะพะบะพะน ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ

## ะัะฟะพะปัะทัะตะผัะต ัะตัะฝะพะปะพะณะธะธ

### Backend
- **Python 3.8+** - ะพัะฝะพะฒะฝะพะน ัะทัะบ ะฟัะพะณัะฐะผะผะธัะพะฒะฐะฝะธั
- **aiogram 3.0+** - ัะพะฒัะตะผะตะฝะฝัะน ะฐัะธะฝััะพะฝะฝัะน ััะตะนะผะฒะพัะบ ะดะปั Telegram Bot API
- **SQLAlchemy 2.0** - ORM ะดะปั ัะฐะฑะพัั ั ะฑะฐะทะพะน ะดะฐะฝะฝัั
- **asyncpg** - ะฐัะธะฝััะพะฝะฝัะน ะดัะฐะนะฒะตั PostgreSQL
- **aiokafka** - ะฐัะธะฝััะพะฝะฝัะน ะบะปะธะตะฝั Apache Kafka
- **pydantic** - ะฒะฐะปะธะดะฐัะธั ะดะฐะฝะฝัั ะธ ะฝะฐัััะพะตะบ

### ะะฐะทะฐ ะดะฐะฝะฝัั
- **PostgreSQL** - ัะตะปััะธะพะฝะฝะฐั ะฑะฐะทะฐ ะดะฐะฝะฝัั ะดะปั ััะฐะฝะตะฝะธั ะดะฐะฝะฝัั ะบะพััะตัะฟะพะฝะดะตะฝัะพะฒ

### ะะฝััะฐััััะบัััะฐ
- **Apache Kafka** - ะฑัะพะบะตั ัะพะพะฑัะตะฝะธะน ะดะปั ะพะฑะผะตะฝะฐ ะฝะพะฒะพัััะผะธ
- **python-dotenv** - ัะฟัะฐะฒะปะตะฝะธะต ะฟะตัะตะผะตะฝะฝัะผะธ ะพะบััะถะตะฝะธั

## ะััะธัะตะบัััะฐ ัะธััะตะผั

```
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
โ    Telegram     โโโโโถโ NewsReceptionPointโโโโโถโ news-to-review  โ
โ      Bot        โ    โ       Bot        โ    โ    (Kafka)      โ
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
        โฒ                        โ                          
        โ                        โผ                          
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโโ            
โ news-reviewed   โโโโโโ   PostgreSQL     โ            
โ    (Kafka)      โ    โ    Database      โ            
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโโ            
```

## ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
NewsReceptionPoint/
โโโ bot/                        # Telegram ะฑะพั ะปะพะณะธะบะฐ
โ   โโโ handlers/              # ะะฑัะฐะฑะพััะธะบะธ ะบะพะผะฐะฝะด ะธ ัะพะพะฑัะตะฝะธะน
โ   โ   โโโ __init__.py
โ   โ   โโโ start.py           # ะะพะผะฐะฝะดะฐ /start ะธ ัะตะณะธัััะฐัะธั
โ   โ   โโโ suggest_news.py    # ะะพะผะฐะฝะดะฐ /suggest_news
โ   โโโ ...
โโโ database/                   # ะะพะดะตะปะธ ะธ ะฟะพะดะบะปััะตะฝะธะต ะบ ะะ
โ   โโโ models.py              # SQLAlchemy ะผะพะดะตะปะธ
โ   โโโ session.py             # ะะฐัััะพะนะบะฐ ัะตััะธะธ ะะ
โโโ kafka/                      # Kafka ะฟัะพะดัััะตั ะธ ะบะพะฝัััะผะตั
โ   โโโ producer.py            # ะัะฟัะฐะฒะบะฐ ัะพะพะฑัะตะฝะธะน ะฒ Kafka
โ   โโโ consumer.py            # ะะพะปััะตะฝะธะต ัะพะพะฑัะตะฝะธะน ะธะท Kafka
โโโ config.py                   # ะะพะฝัะธะณััะฐัะธั ะฟัะธะปะพะถะตะฝะธั
โโโ main.py                     # ะขะพัะบะฐ ะฒัะพะดะฐ ะฟัะธะปะพะถะตะฝะธั
โโโ requirements.txt            # ะะฐะฒะธัะธะผะพััะธ Python
โโโ .env.example               # ะัะธะผะตั ัะฐะนะปะฐ ะฟะตัะตะผะตะฝะฝัั ะพะบััะถะตะฝะธั
```

## ะะพะผะฐะฝะดั ะฑะพัะฐ

### `/start`
- **ะะตัะฒัะน ะทะฐะฟััะบ**: ะะฐะฟััะบะฐะตั ะฟัะพัะตะดััั ัะตะณะธัััะฐัะธะธ (ััะตะฑัะตััั ะฒะฒะตััะธ ะธะผั)
- **ะะพะฒัะพัะฝัะต ะทะฐะฟััะบะธ**: ะะพะบะฐะทัะฒะฐะตั ัะฟะธัะพะบ ะดะพัััะฟะฝัั ะบะพะผะฐะฝะด

### `/suggest_news`
- ะะฐะฟััะบะฐะตั ะฟัะพัะตัั ัะพะทะดะฐะฝะธั ะฝะพะฒะพััะธ
- ะะพัะปะตะดะพะฒะฐัะตะปัะฝะพ ะทะฐะฟัะฐัะธะฒะฐะตั:
  1. ะะฐะณะพะปะพะฒะพะบ ะฝะพะฒะพััะธ
  2. ะขะตะบัั ะฝะพะฒะพััะธ
- ะะตะฝะตัะธััะตั ัะฝะธะบะฐะปัะฝัะน ID ะฝะพะฒะพััะธ
- ะัะฟัะฐะฒะปัะตั ะฝะพะฒะพััั ะฒ Kafka ัะพะฟะธะบ `news-to-review`
- ะะพะทะฒัะฐัะฐะตั ะฟะพะปัะทะพะฒะฐัะตะปั ID ะฝะพะฒะพััะธ ะดะปั ะพััะปะตะถะธะฒะฐะฝะธั

## ะขัะตะฑะพะฒะฐะฝะธั ะบ ัะธััะตะผะต

- **Python 3.8** ะธะปะธ ะฒััะต
- **PostgreSQL** (ะฒะตััะธั 12+)
- **Apache Kafka** (ะฒะตััะธั 2.8+)
- **Telegram Bot Token** (ะฟะพะปััะธัั ั @BotFather)

## ะฃััะฐะฝะพะฒะบะฐ ะธ ะทะฐะฟััะบ

### 1. ะะพะดะณะพัะพะฒะบะฐ ะพะบััะถะตะฝะธั

```bash
# ะะปะพะฝะธัะพะฒะฐะฝะธะต ัะตะฟะพะทะธัะพัะธั
git clone <repository-url>
cd NewsReceptionPoint

# ะกะพะทะดะฐะฝะธะต ะฒะธัััะฐะปัะฝะพะณะพ ะพะบััะถะตะฝะธั
python -m venv venv
source venv/bin/activate  # ะะฐ Windows: venv\Scripts\activate

# ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน
pip install -r requirements.txt
```

### 2. ะะฐัััะพะนะบะฐ ะบะพะฝัะธะณััะฐัะธะธ

ะกะพะทะดะฐะนัะต ัะฐะนะป `.env` ะฝะฐ ะพัะฝะพะฒะต `.env.example`:

```bash
cp .env.example .env
```

ะะฐะฟะพะปะฝะธัะต ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั:

```env
# Telegram Bot
BOT_TOKEN=your_bot_token_here

# PostgreSQL Database
DATABASE_URL=postgresql+asyncpg://postgres:postgres@localhost:5432/news_reception

# Kafka
KAFKA_BOOTSTRAP_SERVERS=localhost:9094
KAFKA_NEWS_TO_REVIEW_TOPIC=news-to-review
KAFKA_NEWS_REVIEWED_TOPIC=news-reviewed
```

### 3. ะะพะดะณะพัะพะฒะบะฐ ะธะฝััะฐััััะบัััั

#### ะะฐะฟััะบ PostgreSQL ะธ Apache Kafka
```bash
# ะะฐะฟััะบ ัะตัะตะท Docker Compose
docker-compose up
```

### 4. ะะฐะฟััะบ ะฟัะธะปะพะถะตะฝะธั

```bash
python main.py
```

## ะะพะฝัะธะณััะฐัะธั

ะัะต ะฝะฐัััะพะนะบะธ ัะฟัะฐะฒะปััััั ัะตัะตะท ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั ะฒ ัะฐะนะปะต `.env`:

- `BOT_TOKEN` - ัะพะบะตะฝ Telegram ะฑะพัะฐ
- `DATABASE_URL` - ัััะพะบะฐ ะฟะพะดะบะปััะตะฝะธั ะบ PostgreSQL
- `KAFKA_BOOTSTRAP_SERVERS` - ะฐะดัะตั Kafka ะฑัะพะบะตัะพะฒ
- `KAFKA_NEWS_TO_REVIEW_TOPIC` - ัะพะฟะธะบ ะดะปั ะพัะฟัะฐะฒะบะธ ะฝะพะฒะพััะตะน ะฝะฐ ัะตัะตะฝะทะธัะพะฒะฐะฝะธะต
- `KAFKA_NEWS_REVIEWED_TOPIC` - ัะพะฟะธะบ ะดะปั ะฟะพะปััะตะฝะธั ัะตะทัะปััะฐัะพะฒ ัะตัะตะฝะทะธัะพะฒะฐะฝะธั

## ะกัััะบัััะฐ ะดะฐะฝะฝัั

### ะะฐะทะฐ ะดะฐะฝะฝัั

#### ะขะฐะฑะปะธัะฐ correspondents
```sql
CREATE TABLE correspondents (
    id SERIAL PRIMARY KEY,
    telegram_id BIGINT UNIQUE,
    username VARCHAR(255)
);
```

### Kafka Messages

#### news-to-review (ะธััะพะดััะธะต ะฝะพะฒะพััะธ)
```json
{
  "newsId": "string",           // ัะฝะธะบะฐะปัะฝัะน UUID ะฝะพะฒะพััะธ
  "authorTelegramId": 123456789, // Telegram ID ะฐะฒัะพัะฐ
  "authorName": "string",       // ะธะผั ะฐะฒัะพัะฐ
  "newsTitle": "string",        // ะทะฐะณะพะปะพะฒะพะบ ะฝะพะฒะพััะธ
  "newsContent": "string"       // ัะตะบัั ะฝะพะฒะพััะธ
}
```

#### news-reviewed (ะฒัะพะดััะธะต ัะตะทัะปััะฐัั)
```json
{
  "newsId": "string",           // UUID ะฝะพะฒะพััะธ
  "authorTelegramId": 123456789, // Telegram ID ะฐะฒัะพัะฐ
  "newsTitle": "string",        // ะทะฐะณะพะปะพะฒะพะบ ะฝะพะฒะพััะธ
  "isAccepted": true,           // ะฟัะธะฝััะฐ ะปะธ ะฝะพะฒะพััั
  "redactorComment": "string"   // ะบะพะผะผะตะฝัะฐัะธะน ัะตะดะฐะบัะพัะฐ
}
```

## ะัะพะฑะตะฝะฝะพััะธ ัะตะฐะปะธะทะฐัะธะธ

1. **ะัะธะฝััะพะฝะฝะฐั ะฐััะธัะตะบัััะฐ**: ะะพะปะฝะพัััั ะฐัะธะฝััะพะฝะฝัะน ะบะพะด ะดะปั ะพะฑัะฐะฑะพัะบะธ ะผะฝะพะถะตััะฒะตะฝะฝัั ะทะฐะฟัะพัะพะฒ
2. **ะะฐัะธะฝะฐ ัะพััะพัะฝะธะน**: ะัะฟะพะปัะทะพะฒะฐะฝะธะต FSM ะดะปั ัะฟัะฐะฒะปะตะฝะธั ะดะธะฐะปะพะณะฐะผะธ ะฟะพะปัะทะพะฒะฐัะตะปะตะน
3. **Graceful error handling**: ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ ะฟะพะดะบะปััะตะฝะธั ะบ ะะ ะธ Kafka
4. **ะฃะฝะธะบะฐะปัะฝัะต ID**: ะะฒัะพะผะฐัะธัะตัะบะฐั ะณะตะฝะตัะฐัะธั UUID ะดะปั ะบะฐะถะดะพะน ะฝะพะฒะพััะธ
5. **ะคะพะฝะพะฒัะต ะทะฐะดะฐัะธ**: Kafka consumer ัะฐะฑะพัะฐะตั ะฒ ัะพะฝะพะฒะพะผ ัะตะถะธะผะต
6. **ะัะพะฒะตัะบะฐ ัะตะณะธัััะฐัะธะธ**: ะะฒัะพะผะฐัะธัะตัะบะฐั ะฟัะพะฒะตัะบะฐ ัะตะณะธัััะฐัะธะธ ะฟะพะปัะทะพะฒะฐัะตะปั

## Workflow ะธัะฟะพะปัะทะพะฒะฐะฝะธั

1. ะะพะปัะทะพะฒะฐัะตะปั ะพัะฟัะฐะฒะปัะตั `/start` ะธ ัะตะณะธัััะธััะตััั
2. ะะพะปัะทะพะฒะฐัะตะปั ะพัะฟัะฐะฒะปัะตั `/suggest_news`
3. ะะพั ะทะฐะฟัะฐัะธะฒะฐะตั ะทะฐะณะพะปะพะฒะพะบ ะฝะพะฒะพััะธ
4. ะะพะปัะทะพะฒะฐัะตะปั ะฒะฒะพะดะธั ะทะฐะณะพะปะพะฒะพะบ
5. ะะพั ะทะฐะฟัะฐัะธะฒะฐะตั ัะตะบัั ะฝะพะฒะพััะธ
6. ะะพะปัะทะพะฒะฐัะตะปั ะฒะฒะพะดะธั ัะตะบัั
7. ะะพั ะณะตะฝะตัะธััะตั UUID ะธ ะพัะฟัะฐะฒะปัะตั ะฝะพะฒะพััั ะฒ Kafka
8. ะะพะปัะทะพะฒะฐัะตะปั ะฟะพะปััะฐะตั ID ะฝะพะฒะพััะธ
9. ะะพัะปะต ัะตัะตะฝะทะธัะพะฒะฐะฝะธั ะฑะพั ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะฒะตะดะพะผะปัะตั ะฟะพะปัะทะพะฒะฐัะตะปั ะพ ัะตะทัะปััะฐัะต

## ะะพะฝะธัะพัะธะฝะณ ะธ ะพัะปะฐะดะบะฐ

ะัะธะปะพะถะตะฝะธะต ะธัะฟะพะปัะทัะตั ััะฐะฝะดะฐััะฝัะน ะผะพะดัะปั `logging` Python ะดะปั ะฒัะฒะพะดะฐ ะธะฝัะพัะผะฐัะธะธ ะพ ัะฐะฑะพัะต:

```python
import logging
logging.basicConfig(level=logging.INFO)
```

ะะพะณะธ ะฒะบะปััะฐัั:
- ะะพะดะบะปััะตะฝะธั ะบ ะฑะฐะทะต ะดะฐะฝะฝัั
- ะัะฟัะฐะฒะบั ะธ ะฟะพะปััะตะฝะธะต Kafka ัะพะพะฑัะตะฝะธะน  
- ะะฑัะฐะฑะพัะบั ะบะพะผะฐะฝะด ะฟะพะปัะทะพะฒะฐัะตะปะตะน
- ะัะธะฑะบะธ ะธ ะธัะบะปััะตะฝะธั

## ะะฐะฒะธัะธะผะพััะธ

ะัะฝะพะฒะฝัะต ะทะฐะฒะธัะธะผะพััะธ ะฟัะพะตะบัะฐ (ะฟะพะดัะพะฑะฝะพ ะฒ `requirements.txt`):

- `aiogram>=3.0.0` - Telegram Bot API
- `python-dotenv>=1.0.0` - ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั
- `sqlalchemy>=2.0.0` - ORM
- `asyncpg>=0.29.0` - PostgreSQL ะดัะฐะนะฒะตั
- `aiokafka>=0.8.0` - Kafka ะบะปะธะตะฝั
- `pydantic>=2.0.0` - ะะฐะปะธะดะฐัะธั ะดะฐะฝะฝัั
- `structlog>=23.0.0` - ะกัััะบัััะธัะพะฒะฐะฝะฝะพะต ะปะพะณะธัะพะฒะฐะฝะธะต
- `prometheus-client>=0.19.0` - ะะตััะธะบะธ