# Система управления новостями на базе Apache Kafka

## Описание проекта

Данный проект представляет собой систему управления новостями, реализующую полный жизненный цикл новостной статьи от создания до публикации. Система построена на принципах микросервисной архитектуры с использованием Apache Kafka в качестве центрального компонента для обеспечения асинхронного взаимодействия между сервисами.

### Основная концепция

Приложение автоматизирует процесс сбора, модерации и публикации новостного контента через распределенную систему, где каждый компонент выполняет специализированную функцию. Система включает три основные роли участников процесса:

- **Корреспонденты** - создают новостной контент через Telegram-бот
- **Главный редактор** - осуществляет модерацию и принятие решений о публикации
- **Конечные пользователи** - потребляют новостной контент через веб-портал

### Практическая значимость

Практическая значимость проекта заключается в возможности его адаптации для различных сценариев использования. Архитектурные принципы, заложенные в основу системы, могут быть перенесены на другие предметные области, требующие обработки больших объемов данных в режиме реального времени.

## Архитектура системы

```
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│    Telegram     │───▶│NewsReceptionPoint│───▶│   news-to-review│───▶│   NewsReview    │
│      Bot        │    │  (Python/aiogram)│    │     (Kafka)     │    │  (Kotlin/Spring)│
└─────────────────┘    └──────────────────┘    └─────────────────┘    └─────────────────┘
        ▲                                                                       │
        │                                                                       ▼
┌─────────────────┐                                                     ┌─────────────────┐
│  news-reviewed  │◀────────────────────────────────────────────────────│  news-reviewed  │
│    (Kafka)      │                                                     │    (Kafka)      │
└─────────────────┘                                                     └─────────────────┘
                                                                                │
                                                                                ▼
┌─────────────────┐    ┌──────────────────┐                            ┌─────────────────┐
│    Конечные     │◀───│     NewsSite    │◀───────────────────────────│  news-to-public │
│  пользователи   │    │  (Python/Flask) │                            │    (Kafka)      │
└─────────────────┘    └──────────────────┘                            └─────────────────┘
```

## Компоненты системы

### 1. NewsReceptionPoint - Телеграм-бот для приема новостей

Телеграм-бот, предназначенный для сбора новостей от корреспондентов и их отправки в систему рецензирования через Apache Kafka.

**Основные возможности:**
- Регистрация пользователей
- Прием новостей (заголовок и содержание)
- Отправка новостей в Kafka топик `news-to-review`
- Получение результатов рецензирования из топика `news-reviewed`
- Уведомление авторов о результатах модерации

**Технологии:** Python, aiogram, SQLAlchemy, asyncpg, aiokafka

### 2. NewsReview - Система рецензирования новостей

Веб-приложение для рецензирования новостей, позволяющее редакторам просматривать поступающие новости, принимать решения об их публикации и оставлять комментарии.

**Основные возможности:**
- Получение новостей для рецензирования из Kafka топика `news-to-review`
- Принятие или отклонение новостей с комментарием
- Отправка результатов рецензирования в топик `news-reviewed`
- Автоматическая публикация принятых новостей в топик `news-to-public`
- Сохранение опубликованных статей в базе данных

**Технологии:** Kotlin, Spring Boot, Spring WebFlux, Spring Data R2DBC, Spring Kafka

### 3. NewsSite - Новостной портал

Веб-приложение для отображения новостей, сохраненных в базе данных. Сайт предназначен только для просмотра новостей без необходимости авторизации или регистрации.

**Основные возможности:**
- Просмотр списка новостей с пагинацией
- Фильтрация новостей по авторам
- Сортировка новостей по времени публикации
- Настройка количества новостей на странице
- Просмотр полного содержания новости на отдельной странице

**Технологии:** Python, Flask, SQLAlchemy, Bootstrap 5.3

## Потоки данных

### Kafka топики

1. **news-to-review** - новости, отправленные корреспондентами на рецензирование
2. **news-reviewed** - результаты рецензирования новостей
3. **news-to-public** - одобренные новости, готовые к публикации

### Формат сообщений

#### news-to-review
```json
{
  "newsId": "string",           // уникальный UUID новости
  "authorTelegramId": 123456789, // Telegram ID автора
  "authorName": "string",       // имя автора
  "newsTitle": "string",        // заголовок новости
  "newsContent": "string"       // текст новости
}
```

#### news-reviewed
```json
{
  "newsId": "string",           // UUID новости
  "authorTelegramId": 123456789, // Telegram ID автора
  "newsTitle": "string",        // заголовок новости
  "isAccepted": true,           // принята ли новость
  "redactorComment": "string"   // комментарий редактора
}
```

#### news-to-public
```json
{
  "newsId": "string",           // UUID новости
  "authorName": "string",       // имя автора
  "newsTitle": "string",        // заголовок новости
  "newsContent": "string"       // текст новости
}
```

## Базы данных

Система использует две базы данных PostgreSQL:

1. **news_reception** (порт 5432) - хранит информацию о зарегистрированных корреспондентах
   ```sql
   CREATE TABLE correspondents (
       id SERIAL PRIMARY KEY,
       telegram_id BIGINT UNIQUE,
       username VARCHAR(255)
   );
   ```

2. **news_db** (порт 5433) - хранит опубликованные новости
   ```sql
   CREATE TABLE articles (
       id SERIAL PRIMARY KEY,
       news_id VARCHAR(50) UNIQUE,
       title VARCHAR(500),
       content TEXT,
       author_name VARCHAR(255),
       publish_time TIMESTAMP NOT NULL
   );
   ```

## Требования к системе

- Docker и Docker Compose
- Python 3.8+ (для NewsReceptionPoint и NewsSite)
- Java 17+ (для NewsReview)
- Gradle 8.14+ (для сборки NewsReview)
- Telegram Bot Token (для NewsReceptionPoint)

## Установка и запуск

### 1. Клонирование репозитория

```bash
git clone <repository-url>
cd FEFU2025_Kafka_Kursovaya
```

### 2. Запуск инфраструктуры

```bash
docker-compose up -d
```

Эта команда запустит:
- Apache Kafka (порт 9094)
- Kafka UI (порт 8082)
- PostgreSQL для NewsReceptionPoint (порт 5432)
- PostgreSQL для NewsSite и NewsReview (порт 5433)

### 3. Настройка и запуск микросервисов

#### NewsReceptionPoint

```bash
cd NewsReceptionPoint

# Создание виртуального окружения
python -m venv venv
# Для Windows
venv\Scripts\activate
# Для Linux/Mac
source venv/bin/activate

# Установка зависимостей
pip install -r requirements.txt

# Настройка .env файла
cp .env.example .env
# Отредактируйте .env файл, добавив токен Telegram бота

# Запуск приложения
python main.py
```

#### NewsReview

```bash
cd NewsReview

# Сборка и запуск приложения
./gradlew bootRun
```

Приложение будет доступно по адресу: http://localhost:8080

#### NewsSite

```bash
cd NewsSite

# Создание виртуального окружения
python -m venv venv
# Для Windows
venv\Scripts\activate
# Для Linux/Mac
source venv/bin/activate

# Установка зависимостей
pip install -r requirements.txt

# Настройка .env файла
cp .env.example .env

# Запуск приложения
python run.py
```

Приложение будет доступно по адресу: http://localhost:5000

## Мониторинг и управление

### Kafka UI

Для мониторинга и управления Kafka используется Kafka UI, доступный по адресу: http://localhost:8082

С его помощью можно:
- Просматривать топики и сообщения
- Создавать новые топики
- Отслеживать потребителей и производителей
- Мониторить состояние кластера

## Жизненный цикл новости

1. Корреспондент отправляет новость через Telegram-бот
2. Бот генерирует уникальный ID и отправляет новость в топик `news-to-review`
3. Сервис NewsReview получает новость из топика
4. Редактор принимает решение о публикации и оставляет комментарий
5. Результат рецензирования отправляется в топик `news-reviewed`
6. Бот получает результат и уведомляет корреспондента
7. Если новость принята, она отправляется в топик `news-to-public`
8. Сервис NewsReview сохраняет принятую новость в базе данных
9. Новостной портал отображает опубликованные новости

## Особенности реализации

1. **Асинхронная архитектура**: Все компоненты системы работают асинхронно, что обеспечивает высокую производительность и масштабируемость
2. **Отказоустойчивость**: Kafka обеспечивает надежное хранение и доставку сообщений даже при сбоях в работе отдельных компонентов
3. **Независимость компонентов**: Каждый микросервис может быть разработан, развернут и масштабирован независимо от других
4. **Разнообразие технологий**: Система демонстрирует интеграцию различных языков программирования и фреймворков (Python, Kotlin, Spring, Flask)
5. **Реактивное программирование**: Использование реактивных подходов в NewsReview для эффективной обработки потоков данных
